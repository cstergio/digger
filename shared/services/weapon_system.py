from shared.model.bullet import Bullet
# Εισάγουμε την κλάση Bullet, η οποία αναπαριστά μια σφαίρα
# που εκτοξεύεται από τον παίκτη στο παιχνίδι.


class WeaponSystem:
    """
    Η κλάση WeaponSystem είναι υπεύθυνη για τη λογική χρήσης του όπλου.
    Συγκεκριμένα, ελέγχει πότε ένας παίκτης μπορεί να πυροβολήσει
    και δημιουργεί τα αντίστοιχα αντικείμενα Bullet.
    """

    def try_fire(self, weapon, player, bullets):
        """
        Προσπαθεί να εκτελέσει έναν πυροβολισμό.

        weapon  : το αντικείμενο Weapon, που γνωρίζει αν το όπλο είναι έτοιμο να πυροβολήσει
        player  : ο παίκτης που πυροβολεί (θέση και κατεύθυνση)
        bullets : λίστα που περιέχει όλες τις ενεργές σφαίρες στο παιχνίδι
        """

        # Ελέγχουμε αν το όπλο μπορεί να πυροβολήσει (cooldown)
        # ΚΑΙ αν ο παίκτης έχει κατεύθυνση (δηλαδή κινείται ή έχει κινηθεί)
        if weapon.can_fire() and player.direction is not None:

            # Δημιουργούμε μια νέα σφαίρα (Bullet)
            # Η σφαίρα ξεκινά από τη θέση του παίκτη (tile_x, tile_y)
            # και κινείται προς την κατεύθυνση του παίκτη
            bullets.append(Bullet(
                player.tile_x,      # x συντεταγμένη του παίκτη στο grid
                player.tile_y,      # y συντεταγμένη του παίκτη στο grid
                player.direction    # κατεύθυνση κίνησης της σφαίρας
            ))

            # Ενημερώνουμε το όπλο ότι μόλις πυροβόλησε,
            # ώστε να ξεκινήσει ξανά το cooldown
            weapon.fired()
