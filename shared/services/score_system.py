from shared.model.types import TileType
# Εισάγουμε το TileType enum, το οποίο περιγράφει τα είδη πλακιδίων
# του επιπέδου (π.χ. χώμα, τούνελ, διαμάντι κ.λπ.).

from shared.services.audio_manager import AudioManager
# Εισάγουμε τον AudioManager, ο οποίος είναι υπεύθυνος
# για την αναπαραγωγή ηχητικών εφέ στο παιχνίδι.


class ScoreSystem:
    """
    Η κλάση ScoreSystem είναι υπεύθυνη για τη διαχείριση
    του σκορ του παίκτη.

    Περιλαμβάνει λογική που:
    - αυξάνει το σκορ όταν ο παίκτης συλλέγει αντικείμενα
    - προσθέτει πόντους από άλλες ενέργειες (π.χ. εξόντωση εχθρών)
    """

    def __init__(self, score):
        """
        Constructor της κλάσης.

        score : αντικείμενο τύπου Score,
        το οποίο αποθηκεύει και διαχειρίζεται τους πόντους του παίκτη.
        """

        # Αποθηκεύουμε αναφορά στο αντικείμενο Score
        self.score = score

    def on_player_enter(self, player, level):
        """
        Καλείται όταν ο παίκτης εισέρχεται σε νέο πλακίδιο.

        player : ο παίκτης που κινείται
        level  : το επίπεδο που περιέχει τα πλακίδια
        """

        # Παίρνουμε το είδος του πλακιδίου
        # στη θέση που βρίσκεται ο παίκτης
        tile = level.get_tile(player.tile_x, player.tile_y)

        # Ελέγχουμε αν το πλακίδιο είναι διαμάντι (EMERALD)
        if tile == TileType.EMERALD:

            # Μετατρέπουμε το πλακίδιο σε τούνελ,
            # ώστε το διαμάντι να θεωρηθεί συλλεγμένο
            level.set_tile(
                player.tile_x,
                player.tile_y,
                TileType.TUNNEL
            )

            # Αυξάνουμε το σκορ του παίκτη
            # μέσω της λογικής που ορίζεται στο αντικείμενο Score
            self.score.add_emerald()

            # Αναπαράγουμε ηχητικό εφέ για την επιβεβαίωση της συλλογής
            AudioManager.play_sound("menu_select")

    def add_points(self, points: int):
        """
        Προσθέτει έναν αυθαίρετο αριθμό πόντων στο σκορ.

        Χρησιμοποιείται σε περιπτώσεις όπως:
        - εξόντωση εχθρού
        - συλλογή χρυσού
        - bonus ανταμοιβές
        """

        # Αυξάνουμε απευθείας τους συνολικούς πόντους
        self.score.points += points
