from shared.model.types import TileType
# Εισάγουμε το enum TileType, το οποίο περιγράφει
# τα διαφορετικά είδη πλακιδίων (χώμα, τούνελ, διαμάντι κ.λπ.)
# που μπορούν να υπάρχουν στο επίπεδο του παιχνιδιού.


class TileInteractionSystem:
    """
    Η κλάση TileInteractionSystem είναι υπεύθυνη για τις αλληλεπιδράσεις
    μιας οντότητας (παίκτης ή εχθρός) με το πλακίδιο στο οποίο εισέρχεται.

    Δεν αποφασίζει ποιος κινείται ή πότε, αλλά μόνο τι συμβαίνει
    όταν μια οντότητα πατήσει σε ένα συγκεκριμένο είδος πλακιδίου.
    """

    def on_enter(self, entity, level):
        """
        Καλείται όταν μια οντότητα εισέρχεται σε νέο πλακίδιο.

        entity : το αντικείμενο που κινείται (π.χ. Player ή Enemy)
        level  : το επίπεδο του παιχνιδιού που περιέχει το grid πλακιδίων
        """

        # Παίρνουμε το είδος του πλακιδίου
        # στη θέση (tile_x, tile_y) της οντότητας
        tile = level.get_tile(entity.tile_x, entity.tile_y)

        # Ελέγχουμε αν το πλακίδιο είναι χώμα (DIRT)
        if tile == TileType.DIRT:

            # Αν είναι χώμα, το μετατρέπουμε σε τούνελ (TUNNEL),
            # δηλαδή θεωρούμε ότι η οντότητα "έσκαψε" το έδαφος
            level.set_tile(
                entity.tile_x,     # x θέση στο grid
                entity.tile_y,     # y θέση στο grid
                TileType.TUNNEL    # νέο είδος πλακιδίου
            )
